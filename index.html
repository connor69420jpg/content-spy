<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Content Spy</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{background:#0B0B10;color:#fff;font-family:'Outfit',sans-serif;-webkit-font-smoothing:antialiased;overflow:hidden;height:100vh}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:rgba(255,255,255,.06);border-radius:4px}
input,select,button{font-family:inherit;outline:none}
.app{display:flex;height:100vh}

.sidebar{width:230px;flex-shrink:0;border-right:1px solid rgba(255,255,255,.06);background:#0E0E14;display:flex;flex-direction:column}
.sb-hd{padding:16px 14px 8px}
.sb-hd small{font-size:8px;text-transform:uppercase;letter-spacing:3px;color:rgba(255,255,255,.2);font-family:'IBM Plex Mono',monospace}
.sb-hd h1{font-size:16px;font-weight:800;margin-top:1px}
.sb-status{display:flex;align-items:center;gap:5px;margin-top:4px}
.sb-status i{width:5px;height:5px;border-radius:50%;display:inline-block}
.sb-status span{font-size:9px;color:rgba(255,255,255,.2);font-family:'IBM Plex Mono',monospace}
.sb-search{padding:4px 10px 6px}
.sb-search input{width:100%;padding:6px 10px;background:rgba(255,255,255,.025);border:1px solid rgba(255,255,255,.06);border-radius:6px;color:#fff;font-size:12px}
.sb-search input::placeholder{color:rgba(255,255,255,.18)}
.sb-list{flex:1;overflow-y:auto;padding:0 4px}
.sb-item{display:flex;align-items:center;gap:6px;padding:5px 7px;border-radius:6px;cursor:pointer;margin-bottom:1px}
.sb-item:hover{background:rgba(255,255,255,.02)}
.sb-item.on{background:rgba(255,255,255,.05)}
.sb-r{width:16px;font-size:9px;color:rgba(255,255,255,.2);font-family:'IBM Plex Mono',monospace;text-align:right;flex-shrink:0}
.sb-av{width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:8px;font-weight:700;flex-shrink:0}
.sb-n{font-size:11px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.sb-item.on .sb-n{font-weight:600}
.sb-item:not(.on) .sb-n{color:rgba(255,255,255,.5)}
.sb-more{padding:6px;text-align:center;font-size:9px;color:rgba(255,255,255,.2);cursor:pointer;font-family:'IBM Plex Mono',monospace}
.sb-ft{padding:8px;border-top:1px solid rgba(255,255,255,.06)}
.sb-ft button{width:100%;padding:6px;background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.06);border-radius:6px;color:rgba(255,255,255,.5);font-size:10px;cursor:pointer}

.main{flex:1;display:flex;flex-direction:column;overflow:hidden}
.top{padding:10px 16px;border-bottom:1px solid rgba(255,255,255,.06);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:6px}
.top-l{display:flex;align-items:center;gap:8px}
.top-av{width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700}
.top-name{font-size:14px;font-weight:800}
.top-sub{font-size:9px;color:rgba(255,255,255,.2);font-family:'IBM Plex Mono',monospace}
.top-r{display:flex;gap:4px;align-items:center;flex-wrap:wrap}
.btn{background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.06);border-radius:5px;padding:4px 10px;color:rgba(255,255,255,.5);font-size:10px;cursor:pointer;font-family:'IBM Plex Mono',monospace}
.btn:disabled{opacity:.3;cursor:default}
.grp{display:flex;background:rgba(255,255,255,.02);border-radius:5px;border:1px solid rgba(255,255,255,.06)}
.grp button{padding:4px 9px;font-size:10px;font-weight:600;border:none;cursor:pointer;font-family:'IBM Plex Mono',monospace;background:transparent;color:rgba(255,255,255,.22)}
.grp button.on{color:#fff}
.sel{padding:4px 8px;font-size:10px;background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.06);border-radius:5px;color:rgba(255,255,255,.5);font-family:'IBM Plex Mono',monospace}
select option{background:#1a1a24;color:#fff}

.cnt{flex:1;overflow-y:auto;padding:14px 16px}
.tabs{display:flex;gap:5px;margin-bottom:12px}
.tab{padding:7px 14px;border-radius:7px;cursor:pointer;font-size:11px;font-weight:600;border:1px solid rgba(255,255,255,.06);background:rgba(255,255,255,.015);display:flex;align-items:center;gap:5px}
.tab.on{border-color:rgba(255,255,255,.12);background:rgba(255,255,255,.04)}
.tab .dot{width:6px;height:6px;border-radius:50%}
.tab .num{font-size:9px;color:rgba(255,255,255,.22);font-family:'IBM Plex Mono',monospace}
.strip{display:flex;gap:14px;margin-bottom:14px;padding:8px 0;border-bottom:1px solid rgba(255,255,255,.06)}
.strip div{display:flex;align-items:baseline;gap:4px}
.strip .v{font-size:16px;font-weight:700}
.strip .l{font-size:9px;color:rgba(255,255,255,.22);font-family:'IBM Plex Mono',monospace}

.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:10px;margin-bottom:14px}
.card{background:#141419;border:1px solid rgba(255,255,255,.06);border-radius:12px;overflow:hidden;cursor:pointer;transition:all .15s}
.card:hover{background:#1a1a22;border-color:rgba(255,255,255,.1);transform:translateY(-1px)}
.card-img{width:100%;aspect-ratio:1;background:#1a1a22;position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center}
.card-img img{width:100%;height:100%;object-fit:cover}
.card-img video{width:100%;height:100%;object-fit:cover;opacity:0;position:absolute;inset:0;transition:opacity .3s}
.card:hover .card-img video{opacity:1}
.card-ph{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;height:100%;padding:16px;text-align:center}
.card-ph .e{font-size:28px;margin-bottom:6px}
.card-ph .c{font-size:12px;color:rgba(255,255,255,.4);line-height:1.5;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
.badges{position:absolute;top:6px;left:6px;display:flex;gap:3px}
.badges span{font-size:8px;padding:2px 6px;border-radius:4px;font-family:'IBM Plex Mono',monospace;font-weight:600;backdrop-filter:blur(8px)}
.b-off{background:rgba(0,0,0,.6);color:#fff;border:1px solid rgba(255,255,255,.15)}
.b-fan{background:rgba(0,0,0,.5);color:rgba(255,255,255,.5);border:1px solid rgba(255,255,255,.08)}
.b-ig{background:rgba(225,48,108,.25);color:#E1306C;border:1px solid rgba(225,48,108,.3)}
.b-tt{background:rgba(37,244,238,.15);color:#25F4EE;border:1px solid rgba(37,244,238,.25)}
.card-type{position:absolute;top:6px;right:6px;font-size:7px;padding:2px 6px;border-radius:4px;background:rgba(0,0,0,.5);color:rgba(255,255,255,.5);font-family:'IBM Plex Mono',monospace;backdrop-filter:blur(8px)}
.card-eng{position:absolute;bottom:6px;right:6px;font-size:10px;font-weight:700;padding:3px 8px;border-radius:5px;font-family:'IBM Plex Mono',monospace;backdrop-filter:blur(8px)}
.play{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:40px;height:40px;border-radius:50%;background:rgba(0,0,0,.5);border:2px solid rgba(255,255,255,.2);display:flex;align-items:center;justify-content:center;pointer-events:none}
.play::after{content:"";border-style:solid;border-width:7px 0 7px 12px;border-color:transparent transparent transparent rgba(255,255,255,.85);margin-left:2px}
.card:hover .play{opacity:0}
.card-bd{padding:10px 12px}
.card-hd{display:flex;align-items:center;gap:5px;margin-bottom:4px}
.card-hn{font-size:11px;font-weight:600;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.card-dt{font-size:9px;color:rgba(255,255,255,.22);font-family:'IBM Plex Mono',monospace}
.card-cp{font-size:11px;color:rgba(255,255,255,.4);line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;margin-bottom:8px}
.card-st{display:flex;gap:8px}
.card-st span{font-size:10px;font-weight:600;font-family:'IBM Plex Mono',monospace;color:rgba(255,255,255,.5)}

/* Modal overlay */
.ov{position:fixed;inset:0;z-index:100;background:rgba(0,0,0,.7);backdrop-filter:blur(12px);display:flex;align-items:center;justify-content:center}
.md{background:#141419;border:1px solid rgba(255,255,255,.08);border-radius:16px;width:92%;max-width:540px;max-height:85vh;overflow-y:auto}
.md-media{width:100%;background:#0a0a0f;position:relative;border-radius:16px 16px 0 0;overflow:hidden;min-height:180px}
.md-media video{width:100%;display:block;max-height:500px;object-fit:contain;background:#000}
.md-media img{width:100%;display:block;object-fit:cover;max-height:500px}
.md-x{position:absolute;top:10px;right:10px;width:30px;height:30px;border-radius:50%;background:rgba(0,0,0,.5);border:none;color:#fff;font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:5}
.md-mute{position:absolute;top:10px;left:10px;padding:4px 9px;border-radius:5px;background:rgba(0,0,0,.5);border:1px solid rgba(255,255,255,.15);color:#fff;font-size:9px;cursor:pointer;font-family:'IBM Plex Mono',monospace;z-index:5}
.md-body{padding:18px 20px}
.md-handle{font-size:14px;font-weight:700}
.md-tags{display:flex;gap:4px;align-items:center;flex-wrap:wrap;margin-bottom:8px}
.md-tag{font-size:8px;padding:2px 5px;border-radius:3px;font-family:'IBM Plex Mono',monospace}
.md-cap{font-size:13px;color:rgba(255,255,255,.5);line-height:1.6;margin-bottom:16px}
.md-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:14px}
.md-stat{background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.06);border-radius:8px;padding:10px;text-align:center}
.md-stat .sv{font-size:18px;font-weight:700}
.md-stat .sl{font-size:8px;color:rgba(255,255,255,.22);text-transform:uppercase;letter-spacing:.8px;font-family:'IBM Plex Mono',monospace;margin-top:2px}
.md-link{display:inline-block;padding:8px 16px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.06);border-radius:7px;color:rgba(255,255,255,.5);font-size:11px;text-decoration:none;font-family:'IBM Plex Mono',monospace}
.md-link:hover{background:rgba(255,255,255,.07);color:#fff}

/* Settings modal */
.stg{background:#111118;border:1px solid rgba(255,255,255,.07);border-radius:14px;padding:22px;width:92%;max-width:440px;max-height:80vh;overflow-y:auto}
.stg h2{font-size:16px;font-weight:700;margin-bottom:16px}
.stg-x{float:right;background:none;border:none;color:rgba(255,255,255,.5);font-size:16px;cursor:pointer}
.stg-s{background:rgba(255,255,255,.018);border-radius:8px;padding:12px;margin-bottom:10px;border:1px solid rgba(255,255,255,.03)}
.stg-t{font-size:8px;color:rgba(255,255,255,.5);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;font-family:'IBM Plex Mono',monospace}
.stg-in{width:100%;padding:7px 10px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:6px;color:#fff;font-size:11px;font-family:'IBM Plex Mono',monospace;margin-top:4px}
.stg-in::placeholder{color:rgba(255,255,255,.15)}
.stg-btn{padding:7px 12px;border:none;border-radius:6px;color:#fff;font-size:10px;font-weight:600;cursor:pointer;margin-right:4px;margin-top:5px}
.stg-steps{font-size:10px;color:rgba(255,255,255,.5);line-height:2;font-family:'IBM Plex Mono',monospace}
.stg-steps b{color:#25F4EE}

.toast{position:fixed;bottom:18px;right:18px;z-index:200;background:#1a1a28;border:1px solid rgba(255,255,255,.06);border-radius:8px;padding:10px 14px;font-size:11px;color:rgba(255,255,255,.5);font-family:'IBM Plex Mono',monospace;animation:ti .3s ease;max-width:350px}
@keyframes ti{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.ft{text-align:center;padding:18px 0;font-size:8px;color:rgba(255,255,255,.15);font-family:'IBM Plex Mono',monospace}
.empty{text-align:center;padding:50px;font-size:13px;color:rgba(255,255,255,.22)}
</style>
</head>
<body>
<div class="app" id="app"></div>
<script>
const A=[
{r:1,n:"Sabrina Carpenter",ig:"sabrinacarpenter",tt:"sabrinacarpenter",c:"#E8456B",a:"SC"},
{r:2,n:"Kendrick Lamar",ig:"kendricklamar",tt:"kendricklamar",c:"#4A90D9",a:"KL"},
{r:3,n:"Billie Eilish",ig:"billieeilish",tt:"billieeilish",c:"#2ECC71",a:"BE"},
{r:4,n:"Tyler, The Creator",ig:"feliciathegoat",tt:"tylerthecreator",c:"#F39C12",a:"TC"},
{r:5,n:"SZA",ig:"sza",tt:"sza",c:"#9B59B6",a:"SZ"},
{r:6,n:"Post Malone",ig:"postmalone",tt:"postmalone",c:"#E67E22",a:"PM"},
{r:7,n:"Doja Cat",ig:"dojacat",tt:"dojacat",c:"#FF69B4",a:"DC"},
{r:8,n:"Bruno Mars",ig:"brunomars",tt:"brunomars",c:"#C0392B",a:"BM"},
{r:9,n:"Chappell Roan",ig:"chappellroan",tt:"chappellroan",c:"#E74C8B",a:"CR"},
{r:10,n:"Lady Gaga",ig:"ladygaga",tt:"ladygaga",c:"#8E44AD",a:"LG"},
{r:11,n:"Tate McRae",ig:"tatemcrae",tt:"tatemcrae",c:"#1ABC9C",a:"TM"},
{r:12,n:"Megan Thee Stallion",ig:"theestallion",tt:"megantheestallion",c:"#E74C3C",a:"MS"},
{r:13,n:"Travis Scott",ig:"travisscott",tt:"travisscott",c:"#34495E",a:"TS"},
{r:14,n:"Bad Bunny",ig:"badbunnypr",tt:"badbunny",c:"#F1C40F",a:"BB"},
{r:15,n:"Ariana Grande",ig:"arianagrande",tt:"arianagrande",c:"#D4A5A5",a:"AG"},
{r:16,n:"Rosalia",ig:"rosalia.vt",tt:"rosalia",c:"#FF4500",a:"RO"},
{r:17,n:"Jack Harlow",ig:"jackharlow",tt:"jackharlow",c:"#5DADE2",a:"JH"},
{r:18,n:"Dua Lipa",ig:"dualipa",tt:"dualipa",c:"#A569BD",a:"DL"},
{r:19,n:"Lil Baby",ig:"lilbaby",tt:"lilbaby",c:"#45B7D1",a:"LB"},
{r:20,n:"Ice Spice",ig:"icespice",tt:"icespice",c:"#FF6347",a:"IS"},
{r:21,n:"Morgan Wallen",ig:"morganwallen",tt:"morganwallen",c:"#8B7355",a:"MW"},
{r:22,n:"21 Savage",ig:"21savage",tt:"21savage",c:"#2C3E50",a:"21"},
{r:23,n:"Gunna",ig:"gunna",tt:"gunna",c:"#27AE60",a:"GU"},
{r:24,n:"Olivia Rodrigo",ig:"oliviarodrigo",tt:"oliviarodrigo",c:"#C39BD3",a:"OR"},
{r:25,n:"Future",ig:"future",tt:"future",c:"#17202A",a:"FU"},
];
const EM={"Reel":"\u{1F3AC}","Carousel":"\u{1F4F8}","Photo":"\u{1F4F7}","Video":"\u{1F3A5}","Duet":"\u{1F46F}","LIVE":"\u{1F534}","Story":"\u23F3"};
let S={sel:A[0],days:7,sort:"views",filt:"all",ptab:"all",showAll:false,q:"",stg:false,exp:null,tok:"",busy:false,data:{},toast:null};
try{const v=JSON.parse(localStorage.getItem("cspy3")||"{}");if(v.tok)S.tok=v.tok;if(v.data)S.data=v.data;}catch(e){}
function save(){try{localStorage.setItem("cspy3",JSON.stringify({tok:S.tok,data:S.data}));}catch(e){}}
function fmt(n){return n>=1e6?(n/1e6).toFixed(1)+"M":n>=1e3?(n/1e3).toFixed(1)+"K":""+n}
function fmtD(d){try{return new Date(d+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch(e){return d}}
function rng(s){return()=>{s=(s*16807)%2147483647;return(s-1)/2147483646}}
let _tt;function toast(m,d){S.toast=m;render();clearTimeout(_tt);_tt=setTimeout(()=>{S.toast=null;render()},d||15
                                                                              000)}

function mock(ar,pl,dy){
  const r=rng(ar.r*1e3+dy+(pl==="tiktok"?5e3:0)),o=[],ty=pl==="instagram"?["Reel","Carousel","Photo"]:["Video","Duet"],
  cp=["New video out now \u{1F525}","Thank you for 1B streams \u{1F495}","Studio vibes \u{1F3B5}","Tour soon \u{1F440}","BTS from shoot \u{1F3AC}",ar.n+" killed this \u{1F60D}","Best of "+ar.n.split(" ")[0]+" \u{1F4AB}","Fan edit \u{1F3A8}",ar.n+" supremacy \u{1F451}","Unreleased snippet \u{1F50D}","Caught this at the show \u{1F4F8}","This choreo is insane \u{1F57A}"],
  n=Math.floor(r()*(dy/1.2))+Math.ceil(dy/3),sx=["_daily","_edits","_fanclub",".updates","_clips"];
  for(let i=0;i<n;i++){const of_=r()>.45,d=new Date(Date.now()-Math.floor(r()*dy)*864e5),vw=of_?Math.floor(r()*15e6)+5e5:Math.floor(r()*3e6)+5e4,lk=Math.floor(vw*(.03+r()*.12)),sv=Math.floor(lk*(.05+r()*.2)),sh=Math.floor(lk*(.02+r()*.1)),cm=Math.floor(lk*(.01+r()*.05)),eg=((lk+sv+sh+cm)/vw*100).toFixed(2),bs=ar.n.toLowerCase().replace(/[^a-z]/g,"").slice(0,8),pt=ty[Math.floor(r()*ty.length)];
  o.push({id:pl+"-"+ar.r+"-"+i,pl,tp:of_?"official":"fan",hn:of_?"@"+(pl==="instagram"?ar.ig:ar.tt):"@"+bs+sx[Math.floor(r()*sx.length)],pt,cp:cp[Math.floor(r()*cp.length)],dt:d.toISOString().split("T")[0],url:"#",vw,lk,sv,sh,cm,eg:+eg,thu:null,vid:null,isV:["Reel","Video","Duet","LIVE"].includes(pt)})}
  return o
}

async function callAPI(actorId,input){
  const res=await fetch("/api/scrape",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:S.tok,actorId,input})});
  const d=await res.json();
  if(!res.ok||d.error)throw new Error(d.error||"Error "+res.status);
  return d.items||d;
}

async function scrape(ar){
  S.busy=true;render();
  const R={instagram:[],tiktok:[],at:new Date().toISOString()};
  try{
    toast("\u{1F50D} Scraping "+ar.n+" Instagram... (1-2 min)",60000);
    const ig=await callAPI("apify/instagram-profile-scraper",{usernames:[ar.ig],resultsLimit:20,resultsType:"posts"});
    R.instagram=ig.map(p=>({id:p.id||p.shortCode||"ig-"+Math.random(),pl:"instagram",tp:"official",hn:"@"+ar.ig,pt:p.type||(p.videoUrl?"Reel":"Photo"),cp:(p.caption||"").slice(0,300),dt:p.timestamp?new Date(p.timestamp).toISOString().split("T")[0]:"",url:p.url||"",vw:p.videoViewCount||p.playCount||0,lk:p.likesCount||0,sv:0,sh:0,cm:p.commentsCount||0,eg:p.videoViewCount?+((p.likesCount+p.commentsCount||0)/p.videoViewCount*100).toFixed(2):0,thu:p.displayUrl||p.thumbnailUrl||null,vid:p.videoUrl||null,isV:!!(p.videoUrl||p.type==="Reel")}));
    toast("\u2713 IG: "+R.instagram.length+" posts",3000);
  }catch(e){toast("\u26A0 IG: "+e.message,5000)}
  try{
    toast("\u{1F50D} Scraping "+ar.n+" TikTok... (1-2 min)",60000);
    const tt=await callAPI("clockworks/free-tiktok-scraper",{profiles:[ar.tt],resultsPerPage:20,shouldDownloadVideos:true,shouldDownloadCovers:true});
    R.tiktok=tt.map(p=>({id:p.id||p.videoId||"tt-"+Math.random(),pl:"tiktok",tp:"official",hn:"@"+ar.tt,pt:p.duetInfo?"Duet":"Video",cp:(p.text||p.desc||"").slice(0,300),dt:p.createTime?new Date(p.createTime*1e3).toISOString().split("T")[0]:"",url:p.webVideoUrl||"",vw:p.playCount||0,lk:p.diggCount||0,sv:p.collectCount||0,sh:p.shareCount||0,cm:p.commentCount||0,eg:p.playCount?+((p.diggCount+p.shareCount+p.commentCount||0)/p.playCount*100).toFixed(2):0,thu:p.videoMeta?.coverUrl||p.covers?.default||null,vid:p.videoUrl||p.videoMeta?.downloadAddr||null,isV:true}));
    toast("\u2713 TT: "+R.tiktok.length+" posts",3000);
  }catch(e){toast("\u26A0 TT: "+e.message,5000)}
  S.data[ar.n]=R;S.busy=false;save();
  toast("\u2713 Done! "+(R.instagram.length+R.tiktok.length)+" posts loaded",4000);render();
}

function getP(ar,pl,dy){
  const lv=S.data[ar.n];let p;
  if(lv&&lv[pl]&&lv[pl].length)p=lv[pl].map(x=>({...x,eg:+x.eg||0}));else p=mock(ar,pl,dy);
  const cut=new Date(Date.now()-dy*864e5).toISOString().split("T")[0];
  p=p.filter(x=>!x.dt||x.dt>=cut);
  if(S.filt==="official")p=p.filter(x=>x.tp==="official");
  if(S.filt==="fan")p=p.filter(x=>x.tp==="fan");
  p.sort((a,b)=>S.sort==="views"?b.vw-a.vw:S.sort==="likes"?b.lk-a.lk:S.sort==="engagement"?b.eg-a.eg:S.sort==="shares"?b.sh-a.sh:new Date(b.dt)-new Date(a.dt));
  return p;
}

function render(){
  const ar=S.sel,ht=!!S.tok,hl=!!S.data[ar.n];
  const vis=(S.showAll?A:A.slice(0,10)).filter(x=>x.n.toLowerCase().includes(S.q.toLowerCase()));
  const ig=getP(ar,"instagram",S.days),tt=getP(ar,"tiktok",S.days);
  let all=S.ptab==="all"?[...ig,...tt]:S.ptab==="instagram"?ig:tt;
  all.sort((a,b)=>S.sort==="views"?b.vw-a.vw:S.sort==="likes"?b.lk-a.lk:S.sort==="engagement"?b.eg-a.eg:S.sort==="shares"?b.sh-a.sh:new Date(b.dt)-new Date(a.dt));
  const tv=all.reduce((s,p)=>s+p.vw,0),tl=all.reduce((s,p)=>s+p.lk,0),ts=all.reduce((s,p)=>s+p.sh,0),ae=all.length?(all.reduce((s,p)=>s+p.eg,0)/all.length).toFixed(1):"0";

  function card(p,i){
    const isI=p.pl==="instagram",ec=p.eg>8?"rgba(0,230,118,.85)":p.eg>4?"rgba(255,215,64,.85)":"rgba(255,255,255,.35)",eb=p.eg>8?"rgba(0,80,40,.7)":p.eg>4?"rgba(80,60,0,.7)":"rgba(0,0,0,.5)",em=EM[p.pt]||"\u{1F4F1}";
    let th;
    if(p.thu){th=`<img src="${p.thu}" loading="lazy">`;if(p.vid)th+=`<video src="${p.vid}" muted loop playsinline preload="none" data-hv></video>`;}
    else th=`<div class="card-ph" style="background:linear-gradient(145deg,${ar.c}40,${ar.c}15,rgba(20,20,25,.95))"><div class="e">${em}</div><div class="c">${p.cp}</div></div>`;
    return`<div class="card" data-id="${p.id}"><div class="card-img">${th}${p.isV?'<div class="play"></div>':""}<div class="badges"><span class="${p.tp==="official"?"b-off":"b-fan"}">${p.tp==="official"?"OFFICIAL":"FAN"}</span><span class="${isI?"b-ig":"b-tt"}">${isI?"IG":"TT"}</span></div><div class="card-type">${p.pt}</div><div class="card-eng" style="background:${eb};color:${ec}">${p.eg}%</div></div><div class="card-bd"><div class="card-hd"><span class="card-hn">${p.hn}</span><span class="card-dt">${fmtD(p.dt)}</span></div><div class="card-cp">${p.cp}</div><div class="card-st"><span>\u25B6 ${fmt(p.vw)}</span><span>\u2665 ${fmt(p.lk)}</span><span>\u2197 ${fmt(p.sh)}</span><span>\u{1F4AC} ${fmt(p.cm)}</span></div></div></div>`
  }

  let modH="";
  if(S.exp){const p=S.exp,isI=p.pl==="instagram",em=EM[p.pt]||"\u{1F4F1}";
    let med;
    if(p.vid)med=`<video id="mvid" src="${p.vid}" controls autoplay loop playsinline poster="${p.thu||""}" style="width:100%;max-height:500px;object-fit:contain;background:#000"></video><button class="md-mute" id="mbtn">\u{1F507} Unmute</button>`;
    else if(p.thu)med=`<img src="${p.thu}">`;
    else med=`<div style="display:flex;flex-direction:column;align-items:center;justify-content:center;padding:36px;min-height:220px;background:linear-gradient(145deg,${ar.c}30,#141419)"><div style="font-size:36px;margin-bottom:8px">${em}</div><div style="font-size:12px;color:rgba(255,255,255,.4);text-align:center;line-height:1.5">${p.cp}</div></div>`;
    const notice=p.vid?`<div style="font-size:9px;color:rgba(255,255,255,.2);font-family:'IBM Plex Mono',monospace;margin-bottom:12px"><span style="color:#00E676">\u25CF</span> Playing video`+(p.url&&p.url!=="#"?` \u00B7 <a href="${p.url}" target="_blank" style="color:${isI?"#E1306C":"#25F4EE"};text-decoration:underline">open on ${isI?"Instagram":"TikTok"} \u2192</a>`:"")+`</div>`:"";
    modH=`<div class="ov" id="mbg"><div class="md"><div class="md-media">${med}<button class="md-x" id="mx">\u2715</button></div><div class="md-body">${notice}<div class="md-tags"><span class="md-handle">${p.hn}</span><span class="md-tag" style="background:${p.tp==="official"?"rgba(255,255,255,.08)":"rgba(255,255,255,.04)"};color:${p.tp==="official"?"#fff":"rgba(255,255,255,.5)"}">${p.tp==="official"?"OFFICIAL":"FAN"}</span><span class="md-tag" style="background:${isI?"rgba(225,48,108,.15)":"rgba(37,244,238,.1)"};color:${isI?"#E1306C":"#25F4EE"}">${isI?"IG":"TT"} \u00B7 ${p.pt}</span><span style="font-size:9px;color:rgba(255,255,255,.22);font-family:'IBM Plex Mono',monospace;margin-left:auto">${fmtD(p.dt)}</span></div><div class="md-cap">${p.cp}</div><div class="md-stats"><div class="md-stat"><div class="sv">${fmt(p.vw)}</div><div class="sl">Views</div></div><div class="md-stat"><div class="sv">${fmt(p.lk)}</div><div class="sl">Likes</div></div><div class="md-stat"><div class="sv">${fmt(p.sv)}</div><div class="sl">Saves</div></div><div class="md-stat"><div class="sv">${fmt(p.sh)}</div><div class="sl">Shares</div></div><div class="md-stat"><div class="sv">${fmt(p.cm)}</div><div class="sl">Comments</div></div><div class="md-stat"><div class="sv" style="color:${p.eg>8?"#00E676":p.eg>4?"#FFD740":"rgba(255,255,255,.5)"}">${p.eg}%</div><div class="sl">Eng Rate</div></div></div>${p.url&&p.url!=="#"?`<a href="${p.url}" target="_blank" class="md-link">View on ${isI?"Instagram":"TikTok"} \u2192</a>`:""}</div></div></div>`}

  let stgH="";
  if(S.stg){stgH=`<div class="ov" id="sbg"><div class="stg"><button class="stg-x" id="sx">\u2715</button><h2>\u{1F575}\uFE0F Settings</h2><div class="stg-s" style="border-color:${ht?"#00E67622":"#FF525222"}"><div class="stg-t">Apify API Token</div><div style="display:flex;align-items:center;gap:4px;margin-bottom:4px"><i style="width:6px;height:6px;border-radius:50%;background:${ht?"#00E676":"#FF5252"};display:inline-block"></i><span style="font-size:10px;color:rgba(255,255,255,.5)">${ht?"Connected":"Not set"}</span></div><input class="stg-in" id="tinp" type="password" placeholder="Paste your Apify token..." value="${S.tok}"><button class="stg-btn" style="background:linear-gradient(135deg,#E1306C,#C13584)" id="tsav">Save Token</button></div><div class="stg-s"><div class="stg-t">Actions</div><button class="stg-btn" style="background:${ht?"linear-gradient(135deg,#E1306C,#C13584)":"rgba(255,255,255,.03)"};opacity:${ht?1:.4}" id="sscrape" ${ht?"":"disabled"}>\u{1F50D} Scrape ${ar.n}</button><button class="stg-btn" style="background:rgba(255,255,255,.04)" id="sclear">\u{1F5D1} Clear Data</button></div><div class="stg-s"><div class="stg-t">Setup Guide</div><div class="stg-steps"><div>1. Go to <b>console.apify.com</b></div><div>2. Settings \u2192 Integrations \u2192 Copy token</div><div>3. Paste above \u2192 Save</div><div>4. Close this \u2192 Click \u21BB Scrape</div><div>5. Wait 1-2 min \u2192 Content loads!</div></div></div>${Object.keys(S.data).length?`<div class="stg-s"><div class="stg-t">Scraped Artists</div><div style="font-size:10px;color:rgba(255,255,255,.5);line-height:1.8;font-family:'IBM Plex Mono',monospace">${Object.entries(S.data).map(([n,d])=>`<div>\u2713 ${n} \u2014 ${(d.instagram||[]).length} IG + ${(d.tiktok||[]).length} TT</div>`).join("")}</div></div>`:""}</div></div>`}

  document.getElementById("app").innerHTML=`
  <div class="sidebar">
    <div class="sb-hd"><small>Content Spy</small><h1>Billboard Content</h1><div class="sb-status"><i style="background:${hl?"#00E676":"#FFD740"};box-shadow:0 0 4px ${hl?"#00E676":"#FFD740"}"></i><span>${hl?"Live":"Demo"}</span></div></div>
    <div class="sb-search"><input placeholder="Search..." value="${S.q}" id="qinp"></div>
    <div class="sb-list">${vis.map(x=>`<div class="sb-item ${S.sel.r===x.r?"on":""}" data-r="${x.r}"><div class="sb-r">${x.r}</div><div class="sb-av" style="background:linear-gradient(135deg,${x.c}BB,${x.c}55)">${x.a}</div><div class="sb-n">${x.n}</div></div>`).join("")}<div class="sb-more" id="tog">${S.showAll?"Top 10 \u25B2":"All 25 \u25BC"}</div></div>
    <div class="sb-ft"><button id="obtn">\u2699 Settings</button></div>
  </div>
  <div class="main">
    <div class="top">
      <div class="top-l"><div class="top-av" style="background:linear-gradient(135deg,${ar.c}BB,${ar.c}55)">${ar.a}</div><div><div class="top-name">${ar.n}</div><div class="top-sub">#${ar.r} \u00B7 @${ar.ig} \u00B7 @${ar.tt}</div></div></div>
      <div class="top-r">
        <button class="btn" id="scr" style="border-color:${ar.c}44;color:${ar.c};background:${ar.c}15" ${ht?"":"disabled"}>${S.busy?"\u23F3":"\u21BB"} Scrape</button>
        <button class="btn" id="csv">CSV \u2193</button>
        <div class="grp">${[{l:"7D",v:7},{l:"14D",v:14},{l:"30D",v:30}].map(t=>`<button data-d="${t.v}" class="${S.days===t.v?"on":""}" style="${S.days===t.v?"background:"+ar.c:""}">${t.l}</button>`).join("")}</div>
        <select class="sel" id="srt">${["views","likes","engagement","shares","date"].map(s=>`<option value="${s}" ${S.sort===s?"selected":""}>${s[0].toUpperCase()+s.slice(1)}</option>`).join("")}</select>
        <div class="grp">${[{l:"All",v:"all"},{l:"Official",v:"official"},{l:"Fan",v:"fan"}].map(f=>`<button data-f="${f.v}" class="${S.filt===f.v?"on":""}" style="${S.filt===f.v?"background:rgba(255,255,255,.07)":""}">${f.l}</button>`).join("")}</div>
      </div>
    </div>
    <div class="cnt">
      <div class="tabs"><div class="tab ${S.ptab==="all"?"on":""}" data-p="all">All<span class="num">${ig.length+tt.length}</span></div><div class="tab ${S.ptab==="instagram"?"on":""}" data-p="instagram"><div class="dot" style="background:#E1306C"></div>IG<span class="num">${ig.length}</span></div><div class="tab ${S.ptab==="tiktok"?"on":""}" data-p="tiktok"><div class="dot" style="background:#25F4EE"></div>TT<span class="num">${tt.length}</span></div></div>
      <div class="strip"><div><span class="v">${fmt(tv)}</span><span class="l">views</span></div><div><span class="v">${fmt(tl)}</span><span class="l">likes</span></div><div><span class="v">${fmt(ts)}</span><span class="l">shares</span></div><div><span class="v" style="color:${+ae>7?"#00E676":+ae>4?"#FFD740":"rgba(255,255,255,.5)"}">${ae}%</span><span class="l">eng</span></div><div><span class="v">${all.length}</span><span class="l">posts</span></div></div>
      <div class="grid">${all.slice(0,30).map((p,i)=>card(p,i)).join("")}</div>
      ${all.length>30?`<div class="ft">Showing 30 of ${all.length}</div>`:""}
      ${all.length===0?`<div class="empty">No posts. ${ht?"Click Scrape.":"Add token in Settings."}</div>`:""}
      <div class="ft">${hl?"Live data \u00B7 "+new Date(S.data[ar.n].at).toLocaleString():"Demo mode \u00B7 Add Apify token in Settings to load real content"}</div>
    </div>
  </div>
  ${modH}${stgH}${S.toast?`<div class="toast">${S.toast}</div>`:""}`;

  // Events
  document.querySelectorAll(".sb-item").forEach(el=>el.onclick=()=>{S.sel=A.find(x=>x.r===+el.dataset.r)||A[0];S.exp=null;render()});
  const qi=document.getElementById("qinp");if(qi)qi.oninput=e=>{S.q=e.target.value;render();document.getElementById("qinp").focus()};
  const tg=document.getElementById("tog");if(tg)tg.onclick=()=>{S.showAll=!S.showAll;render()};
  document.querySelectorAll("[data-d]").forEach(b=>b.onclick=()=>{S.days=+b.dataset.d;render()});
  const sr=document.getElementById("srt");if(sr)sr.onchange=e=>{S.sort=e.target.value;render()};
  document.querySelectorAll("[data-f]").forEach(b=>b.onclick=()=>{S.filt=b.dataset.f;render()});
  document.querySelectorAll("[data-p]").forEach(b=>b.onclick=()=>{S.ptab=b.dataset.p;render()});
  const sc=document.getElementById("scr");if(sc)sc.onclick=()=>{if(!S.busy&&ht)scrape(S.sel)};
  const cv=document.getElementById("csv");if(cv)cv.onclick=()=>{const ap=[...getP(S.sel,"instagram",S.days),...getP(S.sel,"tiktok",S.days)];const h="Platform,Type,Handle,PostType,Date,Views,Likes,Saves,Shares,Comments,EngRate,Caption,URL\n";const r=ap.map(p=>[p.pl,p.tp,p.hn,p.pt,p.dt,p.vw,p.lk,p.sv,p.sh,p.cm,p.eg,'"'+(p.cp||"").replace(/"/g,'""')+'"',p.url].join(",")).join("\n");const bl=new Blob([h+r],{type:"text/csv"});const u=URL.createObjectURL(bl);const a=document.createElement("a");a.href=u;a.download=S.sel.n.replace(/\s+/g,"_")+".csv";a.click()};
  const ob=document.getElementById("obtn");if(ob)ob.onclick=()=>{S.stg=true;render()};
  const sx=document.getElementById("sx");if(sx)sx.onclick=()=>{S.stg=false;render()};
  const sbg=document.getElementById("sbg");if(sbg)sbg.onclick=e=>{if(e.target===sbg){S.stg=false;render()}};
  const ts2=document.getElementById("tsav");if(ts2)ts2.onclick=()=>{S.tok=document.getElementById("tinp").value.trim();save();toast("\u2713 Token saved!");render()};
  const ss=document.getElementById("sscrape");if(ss)ss.onclick=()=>{S.stg=false;if(!S.busy)scrape(S.sel)};
  const scl=document.getElementById("sclear");if(scl)scl.onclick=()=>{S.data={};save();toast("\u{1F5D1} Cleared");render()};
  // Cards
  document.querySelectorAll(".card").forEach(el=>{
    el.onclick=()=>{const p=all.find(x=>x.id===el.dataset.id);if(p){S.exp=p;render()}};
    const v=el.querySelector("video[data-hv]");
    if(v){el.onmouseenter=()=>{v.currentTime=0;v.play().catch(()=>{})};el.onmouseleave=()=>{v.pause();v.currentTime=0}}
  });
  const mbg=document.getElementById("mbg");if(mbg)mbg.onclick=e=>{if(e.target===mbg){S.exp=null;render()}};
  const mx=document.getElementById("mx");if(mx)mx.onclick=()=>{S.exp=null;render()};
  const mb=document.getElementById("mbtn"),mv=document.getElementById("mvid");
  if(mb&&mv)mb.onclick=e=>{e.stopPropagation();mv.muted=!mv.muted;mb.textContent=mv.muted?"\u{1F507} Unmute":"\u{1F50A} Mute"};
}
render();
</script>
</body>
</html>
